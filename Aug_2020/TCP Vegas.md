# TCP Vegas

TCP Vegas通过计算期望数据速率和实际的数据速率的差值来估计网络的拥塞程度，从而调整TCP窗口大小。

- W：窗口大小
- T：最小的往返延迟
- RE：期望吞吐量，RE=W/T
- Ts：实际往返延迟
- R：实际吞吐量

$$
Diff = T(R_E - R) 
$$

$$
Diff = \frac{W}{T_s}(T_s - T) = R(T_s - T)
$$

根据**Little law**，该表达式等价于网络中排队的数据包个数，可以视为拥塞的信号。

定义两个阈值α和β并且α<β，窗口W控制规则如下：

- 如果α <= Diff <= β，则W不变 
- 如果Diff >= β，则W减1，因为这意味着拥塞已经开始出现
- 如果Diff <= α，则W增1，因为实际吞吐量小于期望值，该连接可能没有完全利用网络带宽

TCP Vegas尝试保持网络中一定数量的排队数据。太多排队数据可能导致拥塞，但是太少排队数据会阻止连接迅速利用突然增加的可用带宽。Vegas还消除了Reno的振荡问题，减少了端到端延迟和抖动。

Vegas和Reno在同一链路争夺带宽时，Reno最终会占据绝大部分带宽。因为Reno会尽量填满缓冲区，而Vegas则尽可能占据很小的缓冲空间。Reno填满缓存导致Ts迅速增加，为了保持Diff的稳定，Vegas的吞吐量R会迅速降低到非常小。因此Vegas在公网上竞争不过Reno，没有得到广泛部署。

## Little law

$$
L = \lambda * W
$$

在一个排队过程中，如果1/λ是两个连续unit的间隔到达时间的平均值，L是系统中unit的平均值，W是一个unit在系统中花费的平均时间。如果这三个平均值是有限的，并且对应的随机过程严格平稳并且到达过程是度量传递的，且非零均值。那么上述公式成立。
