# HTTP based Protocol

## Outline

- HLS, LHLS, LL-HLS
- DASH
- CMAF
- HESP

## Todo +10

- HLS原理介绍 +2
- DASH和HLS +1
- LLHLS +2
- CMAF的技术特点的介绍 +4
- HESP技术总结

## HLS

- HLS代表HTTP实时流。HLS是一种流媒体协议，用于通过Internet向观众传输音视频媒体
- HLS流如何工作？
  - 硬件编码器将音视频编码为HEVC视频和AAC音频，然后输出切片后的MPEG-4文件或者MPEG-2传输流
  - 分段器将MP4视频内容切分为短片（10秒）并创建一个索引文件
  - 使用HTTP服务器存储视频流信息
  - HTTP协议将这些小的切片分发到观众的设备上
  - 客户端软件读取索引，然后按顺序请求媒体文件并播放

- HLS可以播放使用H.264或者H.265编码的视频
- HTTP服务器会创建一个M3U8播放列表文件（例如清单文件），用于视频块的索引
- 当使用HLS播放视频流时，给定视频播放器可以检测网络状况的恶化或者改善。播放器首先读取主索引播放列表，确定哪种质量的视频是理想的，然后播放器读取特定质量的索引文件。
- HLS实时流的延迟实际往往在15~30秒范围内
- 总览
  - HLS由三部分组成：服务器组件，分发组件和客户端软件
  - 硬件编码器将音视频编码为HEVC视频和AAC音频，然后输出切片后的MPEG-2传输流（ts文件）。然后软件流分段器将媒体流分成一系列简短的媒体文件，将其存储在Web服务器上。分段器还创建了一个包括媒体文件列表的索引文件。客户端软件读取索引，然后按顺序请求媒体文件并播放
- 服务器组件
  - 负责获取媒体的输入流并对其进行数字编码，按照合适的格式封装媒体并进行分发
- 分配组件
  - 分发系统是Web服务器或者Web缓存系统，可以通过HTTP将媒体文件和索引文件传递给客户端
- 客户端软件
  - 客户端负责确定要请求的媒体，下载并重新组合。客户端软件首先使用URL获取索引文件。索引文件指定了可用媒体文件，解密密钥和可用备用流的位置。对于选定的流，客户端按顺序下载文件。每个文件包含流的连续段，一旦下载了足够数量的数据，客户端就向用户播放视频

## MPEG-DASH

- 国际数字音频和视频标准机构移动图像专家组（MPEG）开发了HTTP动态自适应流（DASH）作为HLS的行业标准替代方案。

- 它也是一种基于HTTP的自适应协议，通过Internet传输流媒体。该技术用于将实时和点播视频内容的片段从Web服务器传输到观众的设备

- DASH的工作原理是自适应比特率流。通过在高质量和低质量的视频之间切换，使内容能够动态适应观看者的带宽容量
- 借助ABR技术，媒体服务器获取单个视频源并转码为多个码率的视频流，可以在各种设备和连接速度上实现无缓冲播放
- 借助ABR技术，DASH可以提供稳定的观看体验，但是在下载各个片段时会造成初始延迟。解决问题的一种方法是减小段大小来调整延迟。另一个选择是采用通用媒体应用格式CMAF
- 从技术角度，HLS和DASH的功能类似。两种技术的区别在于所有权：HLS由苹果指定，DASH作为开源选项。由于苹果的行业影响力，HLS比DASH更受欢迎

## CMAF

- 为什么需要CMAF？对实时流媒体而言，使用不同的媒体格式会增加流传输延迟和成本。
- 常见的容器文件包括:.ts, .mp4, .mov等。如果技术提供商可以在所有播放平台就标准流格式达成一致，那么就需要通用媒体应用程序格式，也就是CMAF。它可以降低成本，复杂性和延迟
- 通过分块编码和分块传输CMAF可以减少视频延迟
- HLS指定使用TS文件容器，而DASH统一使用mp4格式。因此想要覆盖HLS和DASH受众的内容分发者必须对相同的音视频数据进行两次编码和存储，提高了存储成本
- 在2015年中期，微软和苹果一起计划通过一种新的媒体文件格式来消除效率低下的问题，也就是CMAF
- CMAF具有媒体行业感兴趣的许多属性：
  - 它是一个fMP4容器，可以扩展用于新增功能
  - 提供了低延迟模式，进一步将OTT实时流延迟降低到地面和卫星广播分发的阈值以下
  - 可以被HLS播放列表和DASH清单引用
- 块编码的CMAF
  - 分块编码的CMAF有助于加快处理速度
  - 将视频切分为持续时间的小块，在编码后立即发布
  - 一个chunk是最小的单元，一个fragment由多个chunk组成，一个segment由多个fragment组成
  - 将每个segment分割为更小的部分意味着编码器在编码后立即输出每个块来进行交付
  - 每个segment的开头必须有一个关键帧，但是chunk不是
  - 通过将segment分割为chunk，播放器可以提取下载每个chunk并且更快填充缓冲区，这样可以大大减少端到端等待时间

## HESP

- HESP的基础：减少费用，提升性能

- 最简化的manifest

  - manifest不需要开始播放流
  - 低频率更新

- HTTP交付

  - 基于HTTP/1.1的分块传输
  - HTTP/2基于帧的流

- 两个互补流

  - Initialization stream: 可以在任意时刻请求视频并播放
  - Continuation stream: 可以在任意初始化流的图像后继续播放

- 最高获利配置

  - 目标：最低延迟、最低带宽、最低切换次数
  - Continuation stream：长CMAF-CTEsegment，超短chunks，只有P帧

- 最高兼容配置

  - 目标：重复利用LL-DASH流和LL-HLS流
  - Continuation stream：重复大小的CMAF-CTE块（6秒），小chunk（200ms），存在B帧
  
- HESP特点

  - CBCS加密和DRM支持
  - 元数据支持
  - SSAI支持
  - 先进的ABR
  
  