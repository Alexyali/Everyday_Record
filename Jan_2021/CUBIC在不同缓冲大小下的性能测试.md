# CUBIC在不同缓冲大小下的性能测试

测试平台为pantheon，仿真工具为mahimahi。改变mahimahi的路径的队列长度，单位为数据包个数（pkt），从1-100进行测试。测试的路径为固定带宽12Mbps，也就是每个包传输延迟为1ms。

| 缓冲大小\指标 | 带宽利用率（%） | 平均单向延迟（ms） |
| ------------- | --------------- | ------------------ |
| 1             | 8.9             | 1.18               |
| 2             | 69.8            | 2.197              |
| 3             | 91.5            | 3.47               |
| 5             | 99.8            | 5.524              |
| 10            | 100             | 10.89              |
| 50            | 100             | 50.01              |
| 100           | 100             | 98.765             |

## Vegas在不同缓冲大小下的测试

| 缓冲大小\指标 | 带宽利用率（%） | 平均单向延迟（ms） |
| ------------- | --------------- | ------------------ |
| 1             | 6.7             | 1.20               |
| 2             | 72.5            | 2.175              |
| 3             | 89.2            | 3.459              |
| 5             | 98.3            | 4.908              |
| 10            | 99.8            | 5.766              |
| 50            | 99.7            | 5.6                |
| 100           | 99.3            | 5.565              |

## 总结

排队延迟取决于网络瓶颈节点缓冲队列的大小。基于丢包的拥塞算法例如cubic会将缓冲填满，导致很高的排队延迟，但是基于延迟的算法vegas会控制队列延迟，因此在大缓冲区也可以取得很低的排队延迟。

因此基于延迟的算法适合大缓冲区的网络，例如移动蜂窝网络。

反向思考，在有线网络中，只要将每个路由器的缓冲区设置比较小，cubic的端到端延迟可以控制下来。就算cubic会导致bufferbloat问题，但是缓冲区大小限制了排队延迟的最大值。因此就可以兼顾吞吐量和延迟。因此cubic在有线网络中部署还是可以取得很好的性能。