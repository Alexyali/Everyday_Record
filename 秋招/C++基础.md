# C++基础

- 引用和指针的区别

指针是一个变量，存储地址，指向内存存储单元。

引用是原变量的别名，和原变量是一个东西。

- 函数中父类为形参，子类为实参，并且形参是引用

在函数中调用父类的虚函数，在主函数中传入子类，最后调用的是子类的函数

```c++
#include<iostream>
using namespace std;

class Fish {
    public:
    virtual void show() {
        cout << "fish" << endl;
    }
};

class Carp: public Fish {
    public:
    void show() {
        cout << "carp" << endl;
    }
};

void print(Fish& fish) {
    fish.show();
}

int main() {
    Carp carp;
    print(carp);
    return 0;
}
```

- 拷贝构造函数

## 类相关

### 什么是虚函数和纯虚函数

虚函数：被`virtual`关键字修饰的成员函数

```c++
class A {
    public:
    virtual void test() {cout<<"is A"<<endl;} //虚函数
};

class B:public A {
    public:
    virtual void test() {cout<<"is B"<<endl;} //重写
};

int main() {
    A *p=new B();
    p->test(); // is B
    return 0;
}
```

纯虚函数：

- 纯虚函数在类中声明时，加上`=0`;
- 含有纯虚函数的类是抽象类，类中有接口，没有具体实现方法；
- 继承纯虚函数的派生类，如果没有完全实现基类纯虚函数，不能实例化对象。子类必须继承父类的纯虚函数并全部实现后才能创建子类对象。

两者区别：

- 虚函数和纯虚函数可以出现在同一个类中，该类称为抽象基类。

- 使用方式不同：虚函数可以直接使用，纯虚函数必须在派生类实现后才能使用；
- 定义形式不同：虚函数需要加`virtual`关键字，纯虚函数还要加`=0`；
- 析构函数最好定义为虚函数，特别是对于含有继承关系的类；析构函数可以定义为纯虚函数，此时，其所在的类为抽象基类，不能创建实例化对象。

### 虚函数实现机制

虚函数通过虚函数表实现。虚函数地址保存在虚函数表中，虚函数表和类绑定，类的不同对象的的虚函数表是一样的。在类的对象所在的内存空间中保存了虚表指针。虚表指针和对象绑定，每个类的对象都有自己的虚表指针，指向类的虚函数表。

- 虚函数表存放的内容：类的虚函数地址
- 虚函数表建立时间：编译阶段
- 虚表指针保存的位置：对象内存空间最前面，为了正确取到虚函数的偏移值
- **虚函数表和类对应的，虚表指针是和对象对应**

### 什么是多态

多态是不同继承类的对象，对同一消息做出不同的响应。基类的指针指向或者绑定到派生类的对象，使得基类指针呈现出不同的表现方式。具体来说，在基类的函数前加`virtual`关键字，在派生类中重写该函数，运行时根据对象类型调用对应函数。

实现方法：多态通过虚函数实现，一个类有虚函数表，里面保存了虚函数地址。虚函数表的地址保存在含有虚函数的类的实例对象的内存空间中。

实现过程：

1. 在类中用`virtual`关键词声明虚函数；
2. 存在虚函数的类有一个虚函数表，当创建对象时，该对象有一个虚表指针；
3. 当基类指针指向派生类对象，调用虚函数时，实际指向派生类的虚表指针，找到相应的虚函数。

![test](https://github.com/Alexyali/Everyday_Record/blob/master/Sep_2021/virtual_function.PNG)



